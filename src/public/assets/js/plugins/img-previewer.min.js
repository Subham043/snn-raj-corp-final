/*!
 * ImgPreviewer v1.0.4
 * https://github.com/yue1123/img-previewer
 *
 * Copyright 2021-present dh
 * Released under the MIT license
 *
 * Date: 2021-05-05T13:48:45.677Z
*/ !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ImgPreviewer=t()}(this,function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function t(e,t){var n=null;return function(i){clearTimeout(n),n=setTimeout(function(){e(i),clearTimeout(n)},t)}}function n(e){e.preventDefault()}function i(e,t,n){var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,o=window.cancelAnimationFrame||window.mozCancelAnimationFrame,s=t.start||0,a=t.end||0,c=t.step,l=null;!function r(){c>0&&s<a||c<0&&s>a?(s+=c,e.style[t.style]=t.template.replace("$",s),l=i(r)):(n&&n(),o(l))}()}function o(e,t,n){var i=d*n/e,o=r*n/t;return i>o?o:i}function s(e,t,n,i,o){e.style.cssText="width:".concat(t,"px;height:").concat(n,"px;position:fixed; top:").concat(o,"px; left:").concat(i,"px;")}function a(e){u.style.display=e?"block":"none"}function c(e){l.style.overflow=e?"auto":"hidden"}var l,r,d,u=null,h=null,m=null,f=0,p={ratio:.9,zoom:{min:.1,max:5,step:.1},opacity:.6,scrollbar:!0};return function(){var g,v,y;function $(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function e(t,n){if(!(t instanceof n))throw TypeError("Cannot call a class as a function")}(this,$),this.index=0,this.selector=e,this.options=t,this.imageElements=[],t.zoom=Object.assign({},p.zoom,t.zoom||{}),this.config=Object.assign({},p,t),!e||"string"!=typeof e)throw Error("ImagePreviewer plugin should css string selector that on first params,like #el,.el");if(!document.querySelector(e))throw Error("selector is invalid");this.init()}return g=$,y=[{key:"setImageAnimationParams",value:function(e){h.style.setProperty("--offsetX","".concat(e.endX,"px")),h.style.setProperty("--offsetY","".concat(e.endY+30,"px")),h.style.setProperty("--scale","".concat(e.scale)),h.style.setProperty("--rotate","".concat(e.rotate,"deg"))}},],v=[{key:"update",value:function(){var e=this;this.imageElements=document.querySelectorAll("".concat(this.selector," img:not(#preview-image)")),this.imageElements.forEach(function(t,n){t.onclick=null,t.onclick=function(t){e.handleOpen(t,n),a(!0),e.updateIndex(n)}})}},{key:"bindEvent",value:function(){var e=this,i=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(window.navigator.userAgent),o=i?"touchend":"mouseup",s=i?"touchmove":"mousemove";this.imageElements.forEach(function(t,n){t.onclick=function(t){e.handleOpen(t,n),a(!0),e.updateIndex(n)}}),document.getElementById("close").addEventListener("click",function(){e.handleClose()},{passive:!0}),document.getElementById("reset").addEventListener("click",function(){e.handleReset()},{passive:!0}),document.getElementById("prev").addEventListener("click",function(){e.prev()},{passive:!0}),document.getElementById("next").addEventListener("click",function(){e.next()},{passive:!0}),u.addEventListener("click",function(t){"image-container"===t.target.classList[0]&&e.handleClose()},{passive:!0}),h.addEventListener(i?"touchstart":"mousedown",function(e){var t=e.clientX-h.offsetLeft,n=e.clientY-h.offsetTop;this.classList.add("moving"),this["on".concat(s)]=function(e){var i=e.clientX-t,o=e.clientY-n;this.style.left="".concat(i,"px"),this.style.top="".concat(o,"px")},this["on".concat(o)]=function(){this.classList.remove("moving"),this.onmousemove=null},this.onmouseout=function(){this.classList.remove("moving"),this.onmousemove=null}},{passive:!0}),h.addEventListener("mousewheel",function(t){var n=e.config.zoom,i=n.min,o=n.max,s=n.step;t.wheelDelta>0&&f<o?f+=s:f>i&&(f-=s),h.style.setProperty("--scale","".concat(f.toFixed(2)))},!0),document.getElementById("rotate-right").addEventListener("click",function(){e.handelRotateRight()},{passive:!0}),document.getElementById("rotate-left").addEventListener("click",function(){e.handelRotateLeft()},{passive:!0}),u.addEventListener("mousewheel",n,{passive:!0}),document.ondragstart=n,document.ondragend=n,window.onresize=t.bind(null,function(){e.handleClose(),d=window.innerWidth,r=window.innerHeight},100)()}},{key:"handleReset",value:function(){h.style.top="".concat(m.startY,"px"),h.style.left="".concat(m.startX,"px"),h.style.setProperty("--rotate","".concat(0,"deg")),h.style.setProperty("--scale","".concat(m.scale)),m.rotate=0}},{key:"handleOpen",value:function(e,t){var n=this.config.ratio,i=this.imageElements,a=e.target,l=a.width,p=a.height,g=e.clientX-e.offsetX,v=e.clientY-e.offsetY+1;f=o(l,p,n),m={startX:g,startY:v,endX:d/2-l/2-g,endY:r/2-p/2-v,scale:f,rotate:0},h.src=i[t].src,s(h,l,p,g,v),setTimeout(function(){$.setImageAnimationParams(m)}),u.classList.add("show"),this.config.scrollbar||c(!1)}},{key:"handleClose",value:function(){var e,t,n,o,s,l=this.config.opacity,r=this.imageElements[this.index];if(e=r,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n=e.offsetTop,(o=e.offsetHeight)+n>(s=document.documentElement.scrollTop)&&n-s<=t+100){i(u,{start:l,end:0,step:-.02,style:"background",template:"rgba(0, 0, 0, $)"},function(){h.style="",h.src="",u.style.background="",u.classList.remove("hiding"),a(!1)});var d,m=(d=r).getBoundingClientRect(),f=m.top,p=m.left,g=m.width,v=m.height;h.style.cssText="width:".concat(g,"px;height:").concat(v,"px;position: fixed; top: ").concat(f,"px; left: ").concat(p,"px;")}else h.style.display="none",i(u,{start:l,end:0,step:-.05,style:"background",template:"rgba(0, 0, 0, $)"},function(){h.src="",h.style="",u.style="",u.classList.remove("hiding"),a(!1)});u.classList.remove("show"),u.classList.add("hiding"),this.config.scrollbar||c(!0)}},{key:"handelRotateLeft",value:function(){m.rotate-=90,h.style.setProperty("--rotate","".concat(m.rotate,"deg"))}},{key:"handelRotateRight",value:function(){m.rotate+=90,h.style.setProperty("--rotate","".concat(m.rotate,"deg"))}},{key:"prev",value:function(){0!==this.index&&(this.index-=1,this.updateIndex(this.index),this.useIndexUpdateImage(this.index))}},{key:"next",value:function(){this.index<this.imageElements.length-1&&(this.index+=1,this.updateIndex(this.index),this.useIndexUpdateImage(this.index))}},{key:"useIndexUpdateImage",value:function(e){var t=this.config.ratio,n=this.imageElements[e],i=n.height,a=n.width,c=n.src;h.classList.add("moving"),s(h,a,i,d/2-a/2,r/2-i/2),m={endX:0,endY:0,scale:o(a,i,t),rotate:0},h.src=c,$.setImageAnimationParams(m),setTimeout(function(){h.classList.remove("moving")})}},{key:"updateIndex",value:function(e){this.index=e,document.getElementById("total-nums").innerText=this.imageElements.length,document.getElementById("current-index").innerText=e+1}},{key:"render",value:function(){var e=document.getElementById("image-preview-container");e?u=e:((u=document.createElement("div")).classList.add("image-preview-container"),u.id="image-preview-container",u.innerHTML='<div class="preview-header">\n                        <div class="nums">\n\n                            <p>\n                                <span id="current-index"></span>\n                                &nbsp;/&nbsp;\n                                <span id="total-nums"></span>\n                            </p>\n\n                        </div>\n                        <div class="tool-btn">\n                            <button id="rotate-left" data-tooltip="Rotate Right"><i class="iconfont icon-xuanzhuan"></i></button>\n                            <button id="rotate-right" data-tooltip="Rotate Left"><i class="iconfont icon-xuanzhuan1"></i></button>\n                            <button id="reset" data-tooltip="Reset"><i class="iconfont icon-zhongzhi"></i></button>\n                            <button id="close" data-tooltip="Close"><i class="iconfont icon-account-practice-lesson-close"></i></button>\n                        </div>\n                    </div>\n                    <div class="image-container">\n                        <button id="prev" data-tooltip="Prev"><i class="iconfont icon-shangyige"></i></button>\n                        <div class="img-content" id="image-content"><img id="preview-image" src="" alt="" /></div>\n                        <button id="next" data-tooltip="Next"><i class="iconfont icon-xiayige"></i></button>\n                    </div>',l.appendChild(u)),h=document.getElementById("preview-image")}},{key:"init",value:function(){l=document&&document.body||document.getElementsByTagName("body")[0],d=window.innerWidth,r=window.innerHeight,this.imageElements=document.querySelectorAll("".concat(this.selector," img"));for(var e=0,t=this.imageElements.length;e<t;e++)this.imageElements[e].classList.add("zoom-in");this.render(),this.updateIndex(this.index),this.bindEvent(this.imageElements),this.options.onInited&&this.options.onInited()}},],e(g.prototype,v),y&&e(g,y),$}()});